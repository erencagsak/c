generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model KillEvent {
  id                  String   @id @default(cuid())
  eventId             BigInt
  battleId            BigInt?
  timestamp           DateTime
  killArea            String?
  region              String?

  groupMemberCount    Int

  killerId            String
  killerName          String
  killerGuildId       String?
  killerGuildName     String?
  killerAllianceId    String?
  killerAllianceName  String?
  killerAllianceTag   String?
  killerAvgIP         Int
  killerDeathFame     BigInt?
  killerKillFame      BigInt?
  killerFameRatio     Float?
  killerMostUsedWeaponPicture String?

  killerEquipment     Json

  victimId            String
  victimName          String
  victimGuildId       String?
  victimGuildName     String?
  victimAllianceId    String?
  victimAllianceName  String?
  victimAllianceTag   String?
  victimAvgIP         Int
  victimDeathFame     BigInt?
  victimKillFame      BigInt?
  victimFameRatio     Float?
  victimMostUsedWeaponPicture String?

  victimEquipment     Json

  groupMembers Json?

  processed Boolean @default(false)

  createdAt DateTime @default(now())
}

model PlayerPoints {
  id         Int      @id @default(autoincrement())
  playerId   String   @unique
  playerName String

  totalScore Float    @default(0)
  kills      Int      @default(0)
  deaths     Int      @default(0)
  assists    Int      @default(0)

  lastUpdate DateTime @updatedAt
}

model PlayerStats {
  id                Int      @id @default(autoincrement())
  playerId          String   @unique
  playerName        String

  soloKills         Int      @default(0)
  outnumberedKills  Int      @default(0)
  soloDeaths        Int      @default(0)
  outnumberedDeaths Int      @default(0)
  assists           Int      @default(0)

  kda               Float?

  mostUsedWeapon    String?
  totalFame         Int      @default(0)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model PlayerWeaponStats {
  id          Int      @id @default(autoincrement())
  
  playerId    String
  playerName  String
  weapon      String

  kills       Int      @default(0)
  deaths      Int      @default(0)

  killFame    Int      @default(0)
  deathFame   Int      @default(0)

  averageIP   Float?
  lastUsedAt  DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([playerId, weapon])
}